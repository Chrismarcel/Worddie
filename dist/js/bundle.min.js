"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,o){var r,i=new Promise(function(i,s){e(r=t[n].apply(t,o)).then(i,s)});return i.request=r,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function o(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return t(this[n],r,arguments)})})}function r(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function i(e,n,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[n],(o=t(e,r,arguments)).then(function(e){if(e)return new c(e,o.request)});var e,o})})}function s(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function d(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function u(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function l(e){this._db=e}n(s,"_index",["name","keyPath","multiEntry","unique"]),o(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(c,"_cursor",["direction","key","primaryKey","value"]),o(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,o),e(n._request).then(function(e){if(e)return new c(e,n._request)})})})}),d.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},d.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(d,"_store",["name","keyPath","indexNames","autoIncrement"]),o(d,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(d,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(d,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new d(this._tx.objectStore.apply(this._tx,arguments))},n(a,"_tx",["objectStoreNames","mode"]),r(a,"_tx",IDBTransaction,["abort"]),u.prototype.createObjectStore=function(){return new d(this._db.createObjectStore.apply(this._db,arguments))},n(u,"_db",["name","version","objectStoreNames"]),r(u,"_db",IDBDatabase,["deleteObjectStore","close"]),l.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),r(l,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[d,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}})})}),[s,d].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,n,o){var r=t(indexedDB,"open",[e,n]),i=r.request;return i&&(i.onupgradeneeded=function(e){o&&o(new u(i.result,e.oldVersion,i.transaction))}),r.then(function(e){return new l(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=p,module.exports.default=module.exports):self.idb=p}();class IDBOperations{constructor(e){this.word=e,this.dbPromise=idb.open("Worddie",1,e=>{e.createObjectStore("definitions",{keyPath:"word"})})}saveDefinitionstoIDB(e){this.dbPromise.then(t=>{t.transaction("definitions","readwrite").objectStore("definitions").put(e)})}fetchDefinitionsFromIDB(e="single"){return this.dbPromise.then(t=>{const n=t.transaction("definitions").objectStore("definitions");return"single"===e?n.get(this.word.toLowerCase()):n.getAll()}).then(e=>e)}}class Worddie{static getDefinition(e){const t=`https://googledictionaryapi.eu-gb.mybluemix.net/?define=${e=e.trim()}&lang=en`,n=new IDBOperations(e);Promise.resolve(n.fetchDefinitionsFromIDB("single")).then(e=>{e?(console.log(e,"Fetched from IDB"),Worddie.renderDefinitions(e)):(console.log(e,"Fetched from Network"),fetch(t).then(e=>e.json()).then(e=>{n.saveDefinitionstoIDB(e),Worddie.renderDefinitions(e)}).catch(e=>{console.error("Sorry, could not connect to Server",e)}))})}static pronounceWord(e){const t=window.speechSynthesis,n=t.getVoices(),o=new SpeechSynthesisUtterance(e);if(n.length>0){const e=n.filter(e=>"Google UK English Female"===e.name);return o.voice=e[0],o.volume=1,t.speak(o)}return n}static deleteWord(e){}static renderDefinitions(e){let t=0;const{word:n,phonetic:o,meaning:r}=e;Worddie.appendContent("#word",Worddie.capitalizeWord(n)),Worddie.appendContent("#phonetics",`/${o[0]}/`),Object.keys(r).map(e=>{r[e].map(n=>{t+=1;const{definition:o}=n;Worddie.createDefinitionNode(n),Worddie.appendContent(`.word__definition:nth-of-type(${t}) .list-index`,`${t}.`),Worddie.appendContent(`.word__definition:nth-of-type(${t}) .part-of-speech`,Worddie.capitalizeWord(e)),Worddie.appendContent(`.word__definition:nth-of-type(${t}) .definition`,Worddie.capitalizeWord(o))})})}static capitalizeWord(e){return e[0].toUpperCase()+e.substr(1)}static appendContent(e,t){document.querySelector(e).textContent=t}static createDefinitionNode(e){const t=document.createElement("div"),n=document.createElement("span"),o=document.createElement("span"),r=document.createElement("p"),i=document.createElement("div");if(t.classList.add("word__definition"),n.classList.add("list-index"),o.classList.add("part-of-speech"),r.classList.add("definition"),i.classList.add("sub-section"),e.synonyms){const{titleEl:t,listElements:n}=Worddie.renderLists("Synonyms",e.synonyms);i.appendChild(t),n.map(e=>{i.appendChild(e)})}if(e.example){const{titleEl:t,listElements:n}=Worddie.renderLists("Example",e.example);i.appendChild(t),i.appendChild(n)}t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(i),document.querySelector(".word__definitions").append(t)}static renderLists(e,t){let n;const o=document.createElement("h4");return o.classList.add("title"),o.textContent=e,Array.isArray(t)?n=t.map(e=>{const t=document.createElement("span");return t.classList.add("definition-list"),t.textContent=Worddie.capitalizeWord(e),t}):((n=document.createElement("span")).classList.add("definition-list"),n.textContent=Worddie.capitalizeWord(t)),{titleEl:o,listElements:n}}}document.querySelector(".search__input").addEventListener("keyup",function(){const e=document.querySelector(".feather").cloneNode(!0);document.querySelector("button .feather-search").remove(),document.querySelector(".search__btn").append(e),document.querySelector(".search__btn").classList.add("search__btn-active"),document.querySelector(".search__icon").classList.add("search__icon-active"),(this.value.match(/[^A-z]+/)||0===this.value.trim().length)&&(document.querySelector(".search__btn").classList.remove("search__btn-active"),document.querySelector(".search__icon").classList.remove("search__icon-active"))}),window.onload=function(){window.speechSynthesis.getVoices()},document.querySelector(".pronounce").addEventListener("click",function(){const e=document.querySelector("#word").textContent;Worddie.pronounceWord(e)}),document.querySelector(".search__btn").addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(".search__input").value;displayDefinition(t)}),document.querySelector("button.back").addEventListener("click",function(){document.querySelector(".definitions").style.position="fixed",document.querySelector(".definitions").classList.remove("open"),document.querySelector(".home").classList.remove("hide")});const deleteWords=document.querySelectorAll(".delete");Array.from(deleteWords).map(e=>{e.addEventListener("click",function(e){const t=this.parentElement;t.classList.add("deleted"),setTimeout(()=>{t.remove()},500)})});const recentWords=document.querySelectorAll(".recent__word>p");Array.from(recentWords).map(e=>{e.addEventListener("click",function(){const e=this.textContent;displayDefinition(e)})});const displayDefinition=e=>{const t=document.querySelector(".definitions");t.classList.add("open"),t.style.position="fixed",document.querySelector(".home").classList.add("hide"),setTimeout(()=>{window.scrollTo(0,0),document.querySelector(".definitions").style.position="absolute"},200),Array.from(document.querySelectorAll(".word__definition")).map(e=>e.remove()),Worddie.getDefinition(e)};navigator.serviceWorker.register("./sw.js").then(e=>{console.log("Service Worker installed successfully")});